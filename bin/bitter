#!/bin/sh

VERSION=0.1.8

setup () {
  if [ -e engine/setup.sh ]; then
    echo "It appears you already have set up."
    exit 1
  fi

  which_dir="$(dirname $(which $0))"
  link_dir="$(dirname $(test -L "$0" && readlink "$0" || echo "$0"))"
  script_dir=$(cd $which_dir/$link_dir; pwd -P)

  mkdir engine
  cp $script_dir/../setup.sh engine/
  cp $script_dir/../server.js engine/
  cp -R $script_dir/../default engine/
  ln -s $script_dir/../node_modules engine/

  cd engine
  ./setup.sh
}

server () {
  if [ -e engine/server.js ]; then
    node engine/server.js
  else
    echo "Can't find engine/server.js."
    echo "Please do this command from the directory you have set up."
    echo "If you have not set up, do \"bitter setup\" first."
    exit 1
  fi
}

help () {
  cat <<EOF
usage: bitter <command>
Bitter version $VERSION

Commands are:
   setup     Set up new repository
   server    Start server
   version   Show Bitter version
EOF
}

if [ "$1" = "setup" ]; then
  setup
elif [ "$1" = "server" ]; then
  server
elif [ "$1" = "version" ]; then
  echo "$VERSION"
elif [ "$1" = "help" ]; then
  help
else
  help
  exit 1
fi
